# Pull ros-kinetic/ros_base already emerged and the first part to emerge desktop
FROM awesomebytes/roogp_32b_ros_kinetic_desktop_2


RUN mkdir -p $EPREFIX/etc/portage/patches/ros-kinetic/python_qt_binding-0.3.4 &&\
    wget  https://github.com/ros-visualization/python_qt_binding/commit/0a4893791039d5c3f851ee7bc2de832209d52f6d.patch -O $EPREFIX/etc/portage/patches/ros-kinetic/python_qt_binding-0.3.4 &&\
    $PREFIXED emerge ros-kinetic/python_qt_binding

# Setup desktop (237 packages)
RUN $PREFIXED emerge ros-kinetic/desktop || true

# Extra trick needed as qmake points to qtchooser for Rviz, but we can only do it
# when we already have QT5
# so we let ros-kinetic/desktop fail once and do this
RUN cd /tmp/gentoo/usr/bin && \
    unlink qmake && \
    ln -s /tmp/gentoo/usr/lib/qt5/bin/qmake qmake
RUN $PREFIXED emerge ros-kinetic/desktop


# Create the bin packages
# RUN $PREFIXED quickpkg \"*/*\" --include-config y --include-unmodified-config y

ENTRYPOINT ["/bin/bash"]
